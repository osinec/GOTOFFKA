<script>
    document.addEventListener("DOMContentLoaded", function () {
        const shortsList = document.getElementById('shortsList');
        const shortItems = [...document.querySelectorAll('.short-item')];
        const globalArticle = document.getElementById('globalArticle');
        const prevArrow = document.getElementById('prevArrow');
        const nextArrow = document.getElementById('nextArrow');

        const descriptions = [
            { title: "ÐšÐ°Ðº Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ Ð½ÑƒÐ»Ñ", text: "ÐŸÐµÑ€Ð²Ñ‹Ð¹ ÑˆÐ°Ð³ â€” ÑÑ‚Ð¾ Ð½Ðµ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð»Ð°Ð½.", tag: "ÐÐ°Ñ‡Ð°Ð»Ð¾" },
            { title: "Ð¡Ð¸Ð»Ð° Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸", text: "ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¼ÐµÐ½ÑÑŽÑ‚ Ð¶Ð¸Ð·Ð½ÑŒ.", tag: "ÐŸÑ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ°" },
            { title: "Ð’Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ Ð² Ð´ÐµÑ‚Ð°Ð»ÑÑ…", text: "ÐšÑ€Ð°ÑÐ¾Ñ‚Ð° Ð² Ð¼ÐµÐ»Ð¾Ñ‡Ð°Ñ….", tag: "Ð”ÐµÑ‚Ð°Ð»Ð¸" },
            { title: "ÐžÑˆÐ¸Ð±ÐºÐ¸ â€” Ð¾Ð¿Ñ‹Ñ‚", text: "ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð½Ðµ Ñ‚Ð¾Ñ€Ð¼Ð¾Ð·ÑÑ‚ â€” Ð¾Ð½Ð¸ ÑƒÑ‡Ð°Ñ‚.", tag: "Ð Ð¾ÑÑ‚" },
            { title: "Ð¢Ñ‹ Ð½Ðµ Ð¾Ð´Ð¸Ð½", text: "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‚ÐµÑ€ÑÐµÑ‚ÑÑ. Ð­Ñ‚Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾.", tag: "ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°" }
        ];

        let activeIndex = 0;

        // â›” Ð‘Ð¾Ð»ÑŒÑˆÐµ Ð½ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ° â€” ÑƒÐ±Ñ€Ð°Ð½Ð¾ Ð²Ð¸Ð´ÐµÐ¾.play() Ð¾Ñ‚Ð¾Ð²ÑÑŽÐ´Ñƒ.
        function stopAllVideos() {
            shortItems.forEach(item => {
                const video = item.querySelector("video");
                video.pause();
            });
        }

        // Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð²Ð¸Ð´ÐµÐ¾ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼!)
        function setActive(index) {
            shortItems.forEach((item, i) => item.classList.toggle('active', i === index));

            const desc = descriptions[index];
            globalArticle.querySelector('h2').textContent = desc.title;
            globalArticle.querySelector('p').textContent = desc.text;
            globalArticle.querySelector('.tag').textContent = desc.tag;

            globalArticle.classList.remove("active");
            setTimeout(() => globalArticle.classList.add("active"), 10);

            activeIndex = index;
            updateArrows();
            stopAllVideos();
        }

        // Ð¡Ñ‚Ñ€ÐµÐ»ÐºÐ¸ ÑÑ‚Ð°Ð½Ð¾Ð²ÑÑ‚ÑÑ Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¼Ð¸
        function next() {
            activeIndex = (activeIndex + 1) % shortItems.length;
            scrollToActive();
            setActive(activeIndex);
        }

        function prev() {
            activeIndex = (activeIndex - 1 + shortItems.length) % shortItems.length;
            scrollToActive();
            setActive(activeIndex);
        }

        function updateArrows() {
            // Ð¡Ñ‚Ñ€ÐµÐ»ÐºÐ¸ Ð²ÑÐµÐ³Ð´Ð° Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹ â€” Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ»
            prevArrow.style.opacity = 1;
            nextArrow.style.opacity = 1;
        }

        function scrollToActive() {
            shortItems[activeIndex].scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }

        // ðŸŽ¬ Ð—Ð°Ð¿ÑƒÑÐº Ð²Ð¸Ð´ÐµÐ¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ ÐºÐ»Ð¸ÐºÑƒ
        shortItems.forEach((item, index) => {
            const video = item.querySelector("video");

            item.addEventListener("click", () => {
                if (activeIndex !== index) {
                    // ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑˆÐ¾Ñ€Ñ‚Ð° â€” Ð²Ð¸Ð´ÐµÐ¾ ÐÐ• Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼
                    setActive(index);
                    scrollToActive();
                } else {
                    // Ð•ÑÐ»Ð¸ ÑƒÐ¶Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ â€” Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ð¾ ÐºÐ»Ð¸ÐºÑƒ
                    if (video.paused) {
                        stopAllVideos();
                        video.play();
                    } else {
                        video.pause();
                    }
                }
            });
        });

        // Ð‘ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ð¿Ñ€Ð¾ÐºÑ€ÑƒÑ‚ÐºÐ° ÑÑ‚Ñ€ÐµÐ»ÐºÐ°Ð¼Ð¸
        prevArrow.onclick = prev;
        nextArrow.onclick = next;

        // ÐÐ²Ñ‚Ð¾Ð²Ñ‹Ð±Ð¾Ñ€ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ (Ð²Ð¸Ð´ÐµÐ¾ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼)
        let timer;
        shortsList.addEventListener("scroll", () => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                const centerX = shortsList.getBoundingClientRect().left + shortsList.offsetWidth / 2;
                let closest = null, min = Infinity;

                shortItems.forEach(item => {
                    const r = item.getBoundingClientRect();
                    const dist = Math.abs((r.left + r.width / 2) - centerX);
                    if (dist < min) { min = dist; closest = item; }
                });

                if (closest) {
                    const newIndex = Number(closest.dataset.index);
                    if (newIndex !== activeIndex) {
                        setActive(newIndex);
                    }
                }
            }, 120);
        });

        setActive(0);
    });
</script>
